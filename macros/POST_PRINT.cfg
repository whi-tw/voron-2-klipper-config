[gcode_macro POST_PRINT]
description: Clean up states, turn off heaters, set fan timeouts and park at rear
gcode:
    M117 Post Print

    SAVE_GCODE_STATE NAME=STATE_POST_PRINT
    REVO_RETRACT                                         ; Retract filament from revo meltzone
    TURN_OFF_HEATERS
    M107                                                ; Turn off PCF
    BED_MESH_CLEAR
    SET_FAN_SPEED FAN=nevermore SPEED=1
    SET_FAN_TIMEOUTS NEVERMORE=300 PCF=300 EXHAUST=600
    PARK
    RESTORE_GCODE_STATE NAME=STATE_POST_PRINT

    RESTORE_GCODE_STATE NAME=STATE_PRINTING             ; Restore the state that was set during PRINT_START (therefore resetting z-calibration)
    M84 ; Turn off steppers

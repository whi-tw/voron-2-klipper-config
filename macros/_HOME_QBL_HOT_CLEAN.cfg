[gcode_macro _HOME_QBL_HOT_CLEAN]
description: Called from HOME_QBL. Checks if HOT_CLEAN_TEMP is set, if so, heats to that temp and cleans nozzle.
gcode:
    {% set hot_clean_temp = params.HOT_CLEAN_TEMP | default(0) | float %}
    {% if hot_clean_temp >0 %}
        {action_respond_info("HOME_QBL: HOT_CLEAN_TEMP was set. Heating to " + params.HOT_CLEAN_TEMP + " and cleaning nozzle")}
        _PARK
        STATUS_HEATING
        SET_HEATER_TEMPERATURE HEATER=extruder TARGET={hot_clean_temp}
        TEMPERATURE_WAIT       SENSOR=extruder MINIMUM={hot_clean_temp}
        STATUS_CLEANING
        CLEAN_NOZZLE PURGE=0 RETURN=1
        M400
        {action_respond_info("HOME_QBL: Cooling nozzle after hot clean")}
        STATUS_COOLING
        SET_HEATER_TEMPERATURE HEATER=extruder TARGET={initial_temp}
        M106 S255 ; set PCF to max to speed up cooldown
        TEMPERATURE_WAIT       SENSOR=extruder MAXIMUM={initial_temp}
        M106 S0 ; turn off PCF
        STATUS_BUSY
    {% endif %}

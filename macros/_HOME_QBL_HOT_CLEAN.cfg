[gcode_macro _HOME_QBL_HOT_CLEAN]
description: Called from HOME_QBL. Checks if HOT_CLEAN_TEMP is set, if so, heats to that temp and cleans nozzle.
gcode:
    {% set hot_clean_temp = params.HOT_CLEAN_TEMP | default(0) | float %}
    {% set previous_temp = printer.extruder.target %}
    {% if hot_clean_temp >0 %}
        _RESPOND P="HOME_QBL" M="HOT_CLEAN_TEMP was set. Heating nozzle to {params.HOT_CLEAN_TEMP} and cleaning"
        _PARK
        STATUS_HEATING
        SET_HEATER_TEMPERATURE HEATER=extruder TARGET={hot_clean_temp}
        TEMPERATURE_WAIT       SENSOR=extruder MINIMUM={hot_clean_temp}
        STATUS_CLEANING
        CLEAN_NOZZLE PURGE=0 RETURN=1
        M400
        _RESPOND P="HOME_QBL" M="Cooling nozzle to {previous_temp | string} after hot clean"
        STATUS_COOLING
        SET_HEATER_TEMPERATURE HEATER=extruder TARGET={previous_temp}
        M106 S255 ; set PCF to max to speed up cooldown
        TEMPERATURE_WAIT       SENSOR=extruder MAXIMUM={previous_temp}
        M106 S0 ; turn off PCF
        STATUS_BUSY
    {% endif %}

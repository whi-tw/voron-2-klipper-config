[gcode_macro SCRUB_NOZZLE]
gcode:
    {% set brush_x = [196, 254] %}
    {% set brush_y = 302.5 %}
    {% set brush_z = 1.5 %}
    {% set move_speed = 300 %}

    {% set scrub_passes = params.PASSES | default(8) | int %}
    {% set scrub_speed = params.SPEED | default (200) | float %}
    {% set post_purge = params.POST_PURGE |  default(0) %}

    STATUS_CLEANING
    SAVE_GCODE_STATE NAME=scrub_nozzle_state

    G90                               ; Absolute positioning
    {% if post_purge %}
    G0 X{brush_x[0]} Y{brush_y} Z10 F{move_speed * 60} ; Move to LHS of brush
    {% endif %}

    {% for pass in range(scrub_passes) %}
        {% for x in brush_x %}
            G0 X{x} Y{brush_y} Z{brush_z} F{scrub_speed * 60}
        {% endfor %}
    {% endfor %}
    G0 X{brush_x[0]} Y{brush_y} Z{brush_z}
    G0 Z10 F{move_speed * 60}                                           ; Lift away from bed
    G0 Y 250 F{move_speed * 60}                                         ; Move away from z chain
    RESTORE_GCODE_STATE NAME=scrub_nozzle_state
    STATUS_READY
